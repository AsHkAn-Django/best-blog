{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load blog_tags %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-sm rounded">

    <!-- header -->
    <div class="card-header text-center">
      <span class="fw-light">{{ post.publish }}</span> |
      <span class="fw-bold">{{ post.author }}</span>
    </div>

    <!-- body -->
    <div class="card-body">
      <h2 class="card-title text-center">{{ post.title }}</h2>
      {{ post.body|markdown|safe }}
    </div>

    <!-- comments -->
    <div class="card-body border-top">
      <h4>Comments ({{ total_comments }})</h4>

      {% if parents %}
        {% render_comments parents %}
      {% else %}
        <p class="text-muted">No comments yet.</p>
      {% endif %}

      <!-- new top-level comment -->
      <div class="mt-4">
        <h5>Leave a Comment</h5>
        <form method="post" action="{% url 'add_comment' post.pk %}">
          {% csrf_token %}
          <input type="hidden" name="parent_id" value="">
          {% bootstrap_field form.comment %}
          <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
      </div>
    </div>

  </div>
</div>

<script>
  // toggle any reply form
  document.querySelectorAll(".reply-link").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      const id = link.dataset.commentId;
      const form = document.getElementById(`reply-form-${id}`);
      form.style.display = form.style.display === "none" ? "block" : "none";
    });
  });
</script>
{% endblock %}
