{% load blog_tags %}
<ul class="list-group ms-{{ depth|add:'1' }}0 mb-3">
  {% for comment in comments %}
    <li class="list-group-item">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <strong>{{ comment.author.username }}</strong>
          <small class="text-muted">Â· {{ comment.created|date:"M j, Y H:i" }}</small>
        </div>
        <div>
          <span class="badge bg-secondary">{{ comment.like }}</span>
        </div>
      </div>
      <p class="mt-2 mb-1">{{ comment.comment }}</p>

      {# Reply toggle #}
      <a href="#" class="reply-link small" data-comment-id="{{ comment.id }}">
        Reply
      </a>
      <div id="reply-form-{{ comment.id }}" style="display:none; margin-top:0.5rem;">
        <form method="post" action="{% url 'add_comment' comment.post.pk %}">
          {% csrf_token %}
          <input type="hidden" name="parent_id" value="{{ comment.id }}">
          <textarea name="comment" class="form-control form-control-sm mb-1" rows="2" required></textarea>
          <button class="btn btn-sm btn-primary">Post Reply</button>
        </form>
      </div>

      {# Recursive call for children #}
      {% if comment.get_children %}
        {% render_comments comment.get_children depth=depth|add:"1" %}
      {% endif %}
    </li>
  {% endfor %}
</ul>
